---
#author : gineesh
##Version : 1.0

- name: Provision AWS Infrastructure
  hosts: localhost
  gather_facts: no
  connection: local
  vars_files:
    - vars/aws-ec2-new.yml
    - vars/aws-common-vars.yml
    - vars/aws-elb-vars.yml
    - vars/aws-cred.yml
  vars:
    aws_boto_profile: ansible
  environment:
        PYTHONPATH: "/opt/rh/rh-python36/root/lib/python3.6/site-packages"
  tasks:
    - name: Fetch VPC ID
      include_role:
        name: aws-get-vpc-id

    - name: Create Security Group
      include_role:
        name: aws-create-sg
      tags: sgcreate
    
    - name: Create Keypair
      include_role:
        name: aws-create-keypair
      tags: keycreate

    - name: Create ELB Target Group
      include_role:
        name: aws-create-targetgrp
      tags: targetgrpcreate      

    - name: Create ec2 instances
      include_role:
        name: aws-create-ec2
      tags: ec2create
  
